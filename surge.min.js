!function(t){var e="object"==typeof self&&self.self==self&&self||"object"==typeof global&&global.global==global&&global;"function"==typeof define&&define.amd?define(["exports"],function(r){e.surge=t(e,r)}):"undefined"!=typeof exports?t(e,exports):t(e,{})}(function(t,e,r){function n(t){return!!t&&(!(t instanceof Array)||t.length>0)}function i(t){return regex_number.test(t[0])||regex_const_string.test(t)}function o(t){return!/\S/.test(t)}function s(t){this.source=t,this.position=0,this.length=t.length}function p(t){return t.replace(/("|')/g,"\\$1").replace(/(\t|\r|\n)/g,function(t){return l[t.charCodeAt()]})}t.surge=e,e.version="0.2.5 Alpha",e.debug=!0;e.__builtins={};e.register=function(t,e){if(/^[_a-zA-Z]\w*/.test(t))return this.__builtins[t]=e,this;throw'"'+t+'" is not valid filter name.'};var u=/^\s+|\s+$/g,f=/(\w+)\s+in\s+(.*)/,a=/((?:\w+)\s*=\s*(?:[\w\.]+))+/g;regex_number=/[-+\.\d]/,regex_const_string=/^(['"]).*\1$/;var h={"<":"&lt;",">":"&gt;",'"':"&#39;","'":"&quot;","&":"&amp;"};String.prototype.hasOwnProperty("trim")||(String.prototype.trim=function(){return this.replace(u,"")}),e.is_true=n,e.register("trim",function(t){return"string"==typeof t?t.trim():t}).register("ltrim",function(t){return"string"==typeof t?t.replace(/^\s+/,""):t}).register("rtrim",function(t){return"string"==typeof t?t.replace(/\s+$/,""):t}).register("add",function(t){if("number"==typeof t&&arguments.length>1){for(var e=t,r=1;r<arguments.length;r++)e+=parseFloat(arguments[r]);return e}return t}).register("capfirst",function(t){return"string"==typeof t?t.replace(/^([a-z])/,function(t){return t.toUpperCase()}):t}).register("cut",function(t,e){return"string"==typeof t&&e?t.replace(new RegExp(e,"g"),""):t}).register("default",function(t,e){return n(t)?t:e}).register("sort",function(t,e){if(t instanceof Array&&t.length>0){if("undefined"==typeof e){if("string"==typeof t[0])return t.sort();if("number"==typeof t[0]||"boolean"==typeof t[0])return t.sort(function(t,e){return t-e});for(var r in t[0]){e=r;break}if("undefined"==typeof e)return t}if(t[0].hasOwnProperty(e)){var n=function(t){return function(e,r){var n,i;if("object"==typeof e&&"object"==typeof r&&e&&r)return n=e[t],i=r[t],n===i?0:typeof n==typeof i?i>n?-1:1:typeof i>typeof n?-1:1;throw"error"}};return t.sort(n(e))}}return t}).register("reverse",function(t,r){return e.__builtins.sort(t,r).reverse()}).register("escape",function(t){return t.replace(/[<>'"]|&(?!amp;)/g,function(t){return h[t]})}).register("length",function(t){return"string"==typeof t||t instanceof Array?t.length:t}).register("lower",function(t){return"string"==typeof t?t.toLowerCase():t}).register("upper",function(t){return"string"==typeof t?t.toUpperCase():t}).register("striptags",function(t){return"string"==typeof t?t.replace(/<(?:.|\s)*?>/g,""):t}).register("title",function(t){return"string"==typeof t?t.replace(/\B(\w*)/g,function(t){return t.toLowerCase()}).replace(/\b(\w)|\b(\w)/g,function(t){return t.toUpperCase()}):t}).register("truncate",function(t,e){return"string"==typeof t&&t.length>e?t.substring(0,e-3)+"...":t}),s.prototype.eos=function(){return this.position>=this.length},s.prototype.skipWhiteSpace=function(){if(!(this.position>=this.length))for(var t=this.source.charAt(this.position);this.position<this.length&&o(t);)this.position+=1,t=this.source.charAt(this.position)},s.prototype.pop=function(){return this.source.charAt(this.position++)},s.prototype.back=function(t){0===arguments.length?this.position-=1:this.position-=t},s.prototype.skipTo=function(t){var e=this.source.substring(this.position),r=t.length,n=e.indexOf(t);return n>-1?(this.position+=n+r,this.position):(this.position=this.length,-1)},s.prototype.copy=function(t,e){return this.source.substring(t,e)},s.prototype.readWord=function(){for(var t=this.position,e=this.source.charAt(this.position++);!this.eos()&&!o(e);)e=this.source.charAt(this.position++);return this.source.substring(t,this.position-1)};var c={},l={9:"\\t",13:"\\r",10:"\\n"};e.get_template=function(t){var r;if(c.hasOwnProperty(t))r=c[t];else if("document"in global){var n=document.getElementById(t);if(n){var i=n.value||n.innerHTML;r=e.compile(i.trim()),c[t]=r}}return r};e.compile=function(t){function e(t){var e="";e+="model";var r=t.toString(),n=r.toString().indexOf("."),i=r.substring(n);return e+=i}function r(t){return-1!==W.indexOf(t)}function n(t){var e=t.lastIndexOf("|");if(e>0){var o=t.substr(0,e),s=t.substr(e+1),p=n(o),u=s.split(":"),f="_."+u[0].trim();return u.length>1?f+"("+p+","+u[1].trim()+")":f+"("+p+")"}return t=t.trim(),i(t)||r(t.split(".")[0])?t:"context."+t}function o(t){var e,r,n;for(r=t.length-1,n=t.charAt(r);n&&">"!==n;){if("="===n)for(e="",r--,n=t.charAt(r);" "!==n;)e=n+e,r--,n=t.charAt(r);r--,n=t.charAt(r)}return e}var u=new s(t);u.skipWhiteSpace();var h,c,l,g,y,d="";d+='var _html = "";var _ = surge.__builtins;';var m,v,b,_,w,x,k,A,S,$,E,j,O=1,C=[],W=[],T=0,R={};for(y=u.position;!u.eos();)switch(g=u.position,h=u.pop(),"<"===h&&(S=""),h){case"{":if(!u.eos())if(g>y&&(S=p(u.copy(y,g)),d+='_html+="'+p(u.copy(y,g))+'";'),y=u.position,c=u.pop(),"{"===c){if(l=u.pop(),"{"!=l){if(g=u.position,y=u.skipTo("}}"),-1==y)throw'Syntax Error, "}}" is required.';if(w=u.copy(g-1,y-2).trim(),_=n(w),$=o(S),E=e(_),j="binding"+T,$)if("data-hook"===$);else if(d+="_html+="+_+";",d+='_html+="'+p('" data-hook="'+j)+'";',R[E])if(R[E]instanceof Array)q.push({type:"attribute",hook:j,name:$});else{var q=[];q.push(R[E]),q.push({type:"attribute",hook:j,name:$}),R[E]=q}else R[E]={type:"attribute",hook:j,name:$};else if(d+='_html+="'+p('<span data-hook="'+j+'">')+'";',d+="_html+="+_+";",d+='_html+="'+p("</span>")+'";',R[E])if(R[E]instanceof Array)q.push({type:"text",hook:j});else{var q=[];q.push(R[E]),q.push({type:"text",hook:j}),R[E]=q}else R[E]={type:"text",hook:j};S="",$=void 0,T++}}else if("%"===c){u.skipWhiteSpace();var B=u.readWord();if(u.skipWhiteSpace(),g=u.position,y=u.skipTo("%}"),y>-1)if(w=u.copy(g,y-2).trim(),"if"==B||"elif"==B){x=w.split(/\s*(and|or|\(|\))\s*/g);var L=[];for(A=0;A<x.length;A++){var P=x[A];if(i(P))L.push(P);else if(/and|or|\(|\)/.test(P))"and"==P?L.push("&&"):"or"==P?L.push("||"):L.push(P);else if(k=P.split(/(==|>=|<=|<|>)/),_="",k.length>1){_="(";for(var U=0;U<k.length;U++){var z=k[U];_+=i(z)||/==|>=|<=|<|>/.test(z)?z:n(z)}_+=")",L.push(_)}else _=n(P),L.push("surge.is_true("+_+")")}"if"==B?(C.push("if"),d+="if("+L.join("")+"){"):d+="} else if("+L.join("")+"){"}else if("else"==B)d+="} else {";else if("endfor"==B||"endif"==B||"endwith"==B){var F=C.pop();if(B!=="end"+F)throw"Syntax Error, Block tag "+F+" required end"+F+" as endtag sign.";d+="}",("endfor"===B||"endwith"===B)&&W.pop()}else if("for"==B){if(C.push("for"),m="$var_"+O++,v="$loop_var1"+O,b="$loop_var2"+O,!f.test(w))throw'Syntax error for "for" expression.';_=n(RegExp.$2);var I="var "+m+"="+_+";";I+="for(var "+v+"=0,"+b+"="+m+".length;"+v+"<"+b+";"+v+"++){var "+RegExp.$1+"="+m+"["+v+"];",W.push(RegExp.$1),d+=I}else if("with"==B)for(C.push("with"),x=w.match(a),d+="{",A=0;A<x.length;A++){k=x[A].split("=");var H=k[0].trim(),M=n(k[1].trim());d+="var "+H+"="+M+";",W.push(H)}}else"#"===c?y=u.skipTo("#}"):d+='_html+="'+p(u.copy(g,y))+'";'}if(g>y&&(d+='_html += "'+p(u.copy(y,g+1))+'";'),C.length>0)throw'Syntax Error, "'+C.join()+'" need endtag signed.';return d+=" return _html;",{bindings:R,render:new Function("context",d)}}});